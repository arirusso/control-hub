#!/usr/bin/env ruby
$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')

require "optparse"
require "patch"

node_config_path = ARGV.first

options = {}

args = OptionParser.new do |opts|
  opts.banner = "Usage: patch [node config file] [options]"

  opts.on("-p", "--patches [FILE]", "Use patches spec") do |file|
    options[:patches] = file
  end
end

args.parse!

if node_config_path.nil? || !File.exist?(node_config_path)
  puts args.help
  exit 0
else
  node_config_file = File.new(node_config_path)
end

patches = File.new(options[:patches]) unless options[:patches].nil?

hub = Patch::Hub.new(node_config_file, :patches => patches)
hub.print_report
hub.listen
